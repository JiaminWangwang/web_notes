# **JWT与session**
在前后端分离的应用中，后端主要作为Model层，为前端提供数据访问的API，为了保证数据安全可靠地在用户与服务端之间传输，实现服务端的认证就显得极为必要。
常见的服务端认证方法主要有两种：
+ 基于Cookie的认证，如session;
+ 基于Token(令牌)认证，如JWT;

> ## **身份验证(鉴权)流程**
+ ### **session的身份验证流程**
1. 用户输入登录信息；
2. 服务器验证登录信息是否正确，如果正确就创建一个session, 并把session存入数据库；
3. 服务器端向客服端返回带有sessionID的cookie；
4. 在接下来的每次前端发起的请求中都会带上这个cookie，服务器把sessionID与数据库中的相匹配，如果有效则处理该请求；
5. 如果用户退出登录，session会在客户端和服务端都被销毁；

+ ### **JWT的身份验证流程**
1. 用户输入登录信息；
2. 服务器验证登录信息是否正确，如果正确就返回一个已签名的token(加密字符串)；
3. 前端将token存储在客户端，一般是存储在localStorage中，但是也可以存在sessionStorage和cookie中；
4. 在接下来前端每次发起的请求中都会带上这个token;
5. 服务器验证token, 如果token有效则继续处理这个请求；
6. 如果用户退出登录，token会在客户端销毁，而这一步与服务器无关；

> ## **JWT与session的区别**
JWT与session两种认证方法的主要区别有两个：
1. 用户状态保存的位置，session将用户状态保存在服务器端，而JWT将用户状态保存在客户端；
2. session依赖于cookie而实现，在每次请求时都需要带上cookie, 取出相应字段并与服务器端的进行对比，以实现身份的认证。而JWT仅仅需要在HTTP的头部附上token, 由服务器check signature即可实现，无须担心cookie存在的CORS问题。

> ## **JWT与session的优缺点**
### **扩展性**
当应用程序是分布式部署的情况下，session在服务端需要做多机数据共享，因此需要保存在数据库或者redis里面，而JWT的数据都保存在客户端，因此不需要其他的处理。

### **无状态**
JWT不在服务端存储任何状态。RESTful API的原则之一就是无状态，发出请求时，总会返回带有参数的响应，不会产生附加影响，用户的认证状态引入这种附加影响，就破坏了这一原则。另外JWT的载荷中可以存储一些常用信息，用于交换信息，有效地使用JWT,可以降低服务器查询数据库的次数。

### **安全性**
由于JWT的payload是使用base64编码的，并没有加密，因此JWT中不能存储敏感数据。而session的信息是存在服务器端的，相对来说更安全。

### **性能**
由于是无状态使用JWT, 所有的数据都被放到JWT里，如果还要进行一些数据交换，载荷会更大，经过编码之后导致JWT非常长，而由于cookie的限制大小一般是4K, cookie很可能放不下，所以JWT一般放在localStorage里面。并且用户在系统中的每一次HTTP请求都会把JWT携带在Header里面，HTTP请求的Header可能比Body还要大，而如果是sessionID的话就只是很短的一个字符串，因此使用JWT的HTTP请求比使用session的开销大得多。